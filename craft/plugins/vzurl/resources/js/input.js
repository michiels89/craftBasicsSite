"use strict";!function(t,i,e){function s(t){var i=this;this.timer=!1,this.delay=500,this.regex=/^(https?|ftp):\/\/[^\s\/$.?#].[^\s]*$/i,this.$field=t,this.$wrapper=this.$field.parent(),this.$msg=this.$field.next(),this.$field.on("keyup paste",function(){i.checkField()}),this.checkField(!0)}var a={};s.prototype.queueAjax=function(){var i=(new t.Deferred).resolve();return function(t){return i=i.then(t)}}(),s.prototype.checkField=function(i){if(this.timer&&clearTimeout(this.timer),""===this.$field.val())return void this.setStatus({status:"empty"});this.setStatus({status:"checking"}),i?this.validate(this.$field):this.timer=setTimeout(t.proxy(this.validate,this),this.delay)},s.prototype.validate=function(){var t=this,e=this.$field.val(),s={};e in a?s=a[e]:"#"===e.charAt(0)||"?"===e.charAt(0)?s.status="valid":e.match(this.regex)?this.queueAjax(function(){var r=e.replace("http","ht^tp");return i.postActionRequest("vzUrl/validation/check",{url:r}).done(function(i){i.original===t.$field.val()&&(i.http_code>=200&&i.http_code<400?i.original===i.final_url?s.status="valid":(s.status="redirect",s.redirect=i.final_url):s.status="invalid")}).fail(function(){s.status="invalid"}).always(function(){t.setStatus(s),a[e]=s})}):s.status="invalid","status"in s&&this.setStatus(s)},s.prototype.setStatus=function(e){var s=this;if(this.$field.prev().remove(),this.$wrapper.removeClass("empty checking invalid valid redirect"),this.$msg.empty(),"empty"!==e.status&&("invalid"===e.status?(this.$msg.text(i.t("This URL appears to be invalid")),this.$wrapper.addClass("invalid")):"redirect"===e.status&&(this.$field.hasClass("follow-redirects")?(this.$wrapper.addClass("warning"),this.$msg.html("<span>"+i.t("Redirects to")+" "+e.redirect+"</span>"),t("<a/>",{text:i.t("Update"),click:function(t){s.$field.val(e.redirect),s.validate(s.$field),t.preventDefault()}}).appendTo(this.$msg)):e.status="valid"),this.$wrapper.addClass(e.status),"empty"!==e.status&&"checking"!==e.status)){var a=t("<a/>",{href:this.$field.val(),class:"vzurl-visit",target:"_blank","data-icon":"world",title:i.t("Visit URL")+": "+this.$field.val()});this.$field.before(a)}},e.VzUrl=s}(window.jQuery,window.Craft,window);